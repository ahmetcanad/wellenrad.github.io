<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>VibeKreis - Das Spiel</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: "Roboto", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #ffffff;
            background-image: linear-gradient(155deg, #a98affdd 0%, #c3cfe2 100%);
            overflow: hidden;
        }
        
        .game-container {
            text-align: center;
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.444);
            width: 700px;
            height: auto;
            min-height: 780px;
            position: relative;
        }
        
        .title-container {
            position: relative;
            height: 50px;
            margin-bottom: 10px;
            margin-top: -10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .hanging-title {
            font-family: "Press Start 2P", cursive;
            font-size: 28px;
            font-weight: 500;
            color: #fff;
            text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.3);
            letter-spacing: -2px;
            text-transform: uppercase;
            background: linear-gradient(135deg, #9cd4f7 0%, #b03ae7 100%);
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            position: relative;
            transition: transform 0.3s ease;
            cursor: default;
        }
        
        .hanging-title:hover {
            transform: rotate(2deg) scale(1.05);
            animation: wobble 2s ease;
        }
        
        @keyframes wobble {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-2.5eg) scale(1.02); }
            50% { transform: rotate(2.5deg) scale(1.02); }
            75% { transform: rotate(-2deg) scale(1.01); }
        }
        
        .board-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 30px auto 70px;
        }
        
        .board {
            width: 400px;
            height: 400px;
            background-color: #e0e0e0;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .target-area {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            position: absolute;
            overflow: hidden;
            transition: opacity 0.3s ease;
        }
        
        .target-area.hidden-for-countdown {
            opacity: 0;
        }
        
        .needle-container {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 400px;
            height: 400px;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 15;
        }
        
        .needle-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background-color: #303030;
            border-radius: 50%;
            border: 3px solid #fa3949;
            transform: translate(-50%, -50%);
            z-index: 20;
            pointer-events: none;
        }
        
        .needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 180px;
            background: linear-gradient(to top, #fa3949, #ff6b6b);
            border: 2px solid #303030d2;
            border-radius: 2px 2px 0 0;
            transform-origin: 50% 100%;
            transform: translate(-50%, -100%) rotate(0deg);
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }
        
        .category-labels {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .category-label {
            position: absolute;
            font-size: 14px;
            font-weight: bold;
            color: #2f3542;
            padding: 10px 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.7) 0%, rgba(245, 245, 245, 0.7) 100%);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            width: 120px;
            text-align: center;
            z-index: 5;
            transition: all 0.3s ease;
            opacity: 0;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 45px;
            transform: scale(0.8);
            border: 2px solid transparent;
        }
        
        .category-label.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        .category-label.top {
            top: -55px;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            border-color: #3742fa;
            background: linear-gradient(135deg, rgba(227, 242, 255, 0.8) 0%, rgba(255, 255, 255, 0.8) 100%);
        }
        
        .category-label.top.visible {
            transform: translateX(-50%) scale(1);
        }
        
        .category-label.right {
            top: 50%;
            right: -55px;
            left: auto;
            transform: translateY(-50%) scale(0.8);
            border-color: #ff6b6b;
            background: linear-gradient(135deg, rgba(255, 227, 227, 0.8) 0%, rgba(255, 255, 255, 0.8) 100%);
        }
        
        .category-label.right.visible {
            transform: translateY(-50%) scale(1);
        }
        
        .category-label.bottom {
            bottom: -55px;
            left: 50%;
            top: auto;
            transform: translateX(-50%) scale(0.8);
            border-color: #27ff5d;
            background: linear-gradient(135deg, rgba(227, 255, 227, 0.8) 0%, rgba(255, 255, 255, 0.8) 100%);
        }
        
        .category-label.bottom.visible {
            transform: translateX(-50%) scale(1);
        }
        
        .category-label.left {
            top: 50%;
            left: -55px;
            transform: translateY(-50%) scale(0.8);
            border-color: #feca57;
            background: linear-gradient(135deg, rgba(255, 243, 227, 0.8) 0%, rgba(255, 255, 255, 0.8) 100%);
        }
        
        .category-label.left.visible {
            transform: translateY(-50%) scale(1);
        }
        
        .game-mode-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .mode-button {
            padding: 10px 20px;
            border: 2px solid #3742fa;
            background: white;
            color: #3742fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .mode-button.active {
            background: #3742fa;
            color: white;
        }
        
        .mode-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(55, 66, 250, 0.3);
        }
        
        .round-counter {
            font-size: 18px;
            color: #2f3542;
            margin-bottom: 15px;
            font-weight: bold;
            padding: 8px 15px;
            background: #f5f5f5;
            border-radius: 8px;
            display: inline-block;
        }
        
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .countdown-number {
            font-family: "Press Start 2P", cursive;
            font-size: 120px;
            color: #ffffff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
            animation: pulse 1s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .controls {
            margin-top: 50px;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            font-size: 16px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #5352ed;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            flex: 1 0 auto;
            max-width: 150px;
        }
        
        button:hover:not(:disabled) {
            background-color: #3742fa;
        }
        
        button:disabled {
            background-color: #a4b0be;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        #score {
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #2f3542;
        }
        
        #totalScore {
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #2f3542;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }
        
        .team-score {
            background-color: #f5f5f5;
            padding: 8px 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }
        
        .team-score.current-team {
            background-color: #3742fa;
            color: white;
            border-color: #3742fa;
            box-shadow: 0 3px 10px rgba(55, 66, 250, 0.3);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .team-setup {
            background-color: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 2rem auto;
            text-align: center;
        }
        
        .team-count {
            margin-bottom: 1rem;
        }
        
        .team-name-input {
            margin-bottom: 0.5rem;
            padding: 8px;
            width: 80%;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .team-name-input.error {
            border-color: #ff6b6b;
            background-color: #ffe0e0;
        }
        
        #teamCount.error {
            border-color: #ff6b6b;
            background-color: #ffe0e0;
        }
        
        .error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .count-error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
            margin-bottom: 10px;
            display: none;
        }
        
        .count-error-message.show {
            display: block;
        }
        
        #startGame {
            margin-top: 1rem;
        }
        
        .modal-content {
            background-color: #ffffff;
            margin: 10% auto;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease-out;
        }
        
        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .modal h2 {
            color: #3742fa;
            font-size: 28px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-body {
            color: #2f3542;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .modal-body ol {
            padding-left: 20px;
        }
        
        .modal-body ul {
            padding-left: 30px;
            margin-top: 10px;
        }
        
        .score-5 {
            color: #FFD700;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(255, 215, 0, 0.5);
        }
        
        .score-3 {
            color: #3742fa;
            font-weight: bold;
        }
        
        .score-1 {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .score-0 {
            color: #a4b0be;
            font-weight: bold;
        }
        
        .close-button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #3742fa;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }
        
        .close-button:hover {
            background-color: #2c3aef;
        }
        
        .how-to-play {
            margin-top: 20px;
            letter-spacing: 2px;
            background-color: #232323f4;
            min-width: 60px;
        }
        
        .divider {
            height: 5px;
            width: 85%;
            max-width: 400px;
            margin: 15px auto;
            border: 0;
            border-radius: 2px;
            background: linear-gradient(
                to right,
                #f46457,
                hsl(191, 88%, 70%),
                #ff6bb5
            );
        }
        
        .game-over-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
        }
        
        .game-over-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 10% auto;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .game-over-content h2 {
            font-family: "Press Start 2P", cursive;
            font-size: 32px;
            margin-bottom: 30px;
            text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.3);
        }
        
        .final-scores {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .final-team-score {
            font-size: 20px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .winner-highlight {
            background: rgba(255, 215, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 5px;
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }
        
        /* Mobile Portrait Mode - Fullscreen */
        @media (max-width: 768px) and (orientation: portrait) {
            body {
                background: linear-gradient(155deg, #a98affdd 0%, #c3cfe2 100%);
                padding: 0;
                margin: 0;
            }
            
            .game-container {
                width: 100vw;
                height: 100vh;
                padding: 10px;
                border-radius: 0;
                box-shadow: none;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                min-height: unset;
                box-sizing: border-box;
            }
            
            .board-container,
            .board,
            .target-area,
            .needle-container {
                width: min(85vw, 350px);
                height: min(85vw, 350px);
                margin-bottom: 50px;
            }
            
            .needle {
                height: min(42.5vw, 165px);
            }
            
            .hanging-title {
                font-size: min(8vw, 32px);
                padding: 10px 20px;
            }
            
            .title-container {
                height: 50px;
                margin-bottom: 15px;
            }
            
            .category-label {
                font-size: 12px;
                padding: 6px 8px;
                width: 90px;
                min-height: 35px;
            }
            
            .category-label.top {
                top: -45px;
            }
            
            .category-label.bottom {
                bottom: -45px;
            }
            
            .category-label.left {
                left: -45px;
            }
            
            .category-label.right {
                right: -45px;
            }
            
            button {
                font-size: 14px;
                padding: 10px 15px;
                max-width: 30%;
            }
            
            .controls {
                gap: 5px;
                margin-top: 25px;
                margin-bottom: 10px;
            }
            
            #score, #totalScore {
                font-size: 16px;
                margin-top: 10px;
            }
            
            .team-score {
                font-size: 14px;
                padding: 6px 12px;
            }
            
            .countdown-number {
                font-size: 60px;
            }
            
            .modal-content {
                margin: 5% auto;
                padding: 15px;
                width: 95%;
            }
            
            .modal h2 {
                font-size: 20px;
            }
            
            .modal-body {
                font-size: 13px;
            }
            
            .mode-button {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            .round-counter {
                font-size: 14px;
                margin-bottom: 10px;
            }
        }
        
        /* Mobile Landscape Mode */
        @media (max-width: 768px) and (orientation: landscape) {
            .game-container {
                padding: 0.5rem;
                min-height: unset;
            }
            
            .board-container,
            .board,
            .target-area,
            .needle-container {
                width: 250px;
                height: 250px;
                margin-bottom: 40px;
            }
            
            .needle {
                height: 115px;
            }
            
            .hanging-title {
                font-size: 24px;
                padding: 8px 16px;
            }
            
            .title-container {
                height: 40px;
                margin-bottom: 10px;
            }
            
            .category-label {
                font-size: 11px;
                padding: 4px 6px;
                width: 80px;
                min-height: 30px;
            }
            
            .category-label.top {
                top: -40px;
            }
            
            .category-label.bottom {
                bottom: -40px;
            }
            
            .category-label.left {
                left: -40px;
            }
            
            .category-label.right {
                right: -40px;
            }
            
            button {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .controls {
                margin-top: 20px;
            }
            
            #score, #totalScore {
                font-size: 14px;
                margin-top: 5px;
            }
            
            .team-score {
                font-size: 12px;
                padding: 4px 8px;
            }
            
            .mode-button {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            .round-counter {
                font-size: 12px;
                padding: 4px 8px;
                margin-bottom: 10px;
            }
        }
    </style>
</head>

<body>
    <div id="countdownOverlay" class="countdown-overlay">
        <div class="countdown-number" id="countdownNumber"></div>
    </div>
    
    <div id="howToPlayModal" class="modal">
        <div class="modal-content">
            <h2>Wie spielt man VibeKreis?</h2>
            <div class="modal-body">
                <ol>
                    <li>Vier Kategorien werden um den Kreis angezeigt (oben = blau, rechts = rot, unten = gr√ºn, links = gelb).</li>
                    <li>Nach einem kurzen Countdown gibt die "Gedankenlesesende Person" einen Hinweis, 
                        wo sich das Ziel im Kreis befindet.</li>
                    <li>Das Team diskutiert und entscheidet, wohin der Zeiger gedreht wird.</li>
                    <li>Klickt und zieht den Zeiger, um eure Vermutung einzustellen.</li>
                    <li>Klickt auf "Ziel verbergen", um eure Vermutung festzulegen.</li>
                    <li>Klickt auf "Ziel aufdecken", um zu sehen, wie nah ihr dran wart.</li>
                    <li>Punktevergabe:
                        <ul>
                            <li><span class="score-5">5 Punkte:</span> Volltreffer (gold - winziger Bereich)</li>
                            <li><span class="score-3">3 Punkte:</span> Nah dran (blau - kleiner Bereich)</li>
                            <li><span class="score-1">1 Punkt:</span> In der N√§he (rot - mittlerer Bereich)</li>
                            <li><span class="score-0">0 Punkte:</span> Daneben (grau)</li>
                        </ul>
                    </li>
                    <li>W√§hlt zwischen Endlosspiel oder 5-Runden-Modus.</li>
                    <li>Klickt auf "N√§chste Runde", um fortzufahren.</li>
                </ol>
            </div>
            <button class="close-button">Verstanden!</button>
        </div>
    </div>
    
    <div id="gameOverModal" class="game-over-modal">
        <div class="game-over-content">
            <h2>üéâ Spielende! üéâ</h2>
            <div class="final-scores" id="finalScores"></div>
            <button class="close-button" onclick="location.reload()">Neues Spiel</button>
        </div>
    </div>
    
    <div id="teamSetup" class="team-setup">
        <div class="title-container">
            <h1 class="hanging-title">VibeKreis</h1>
        </div>
        <h2>
            Sprache: <img src="https://flagcdn.com/de.svg" width="35" alt="Germany">
        </h2>
        <h3 class="divider"></h3>
        <h4>Teameinstellung</h4>
        <div class="team-count">
            <label for="teamCount">Anzahl der Teams (1-4):</label>
            <input type="number" id="teamCount" min="1" max="4" value="1">
        </div>
        <div class="count-error-message" id="countErrorMessage"></div>
        <div id="teamNames"></div>
        <div class="error-message" id="errorMessage"></div>
        <h4>Spielmodus</h4>
        <div class="game-mode-selector">
            <button class="mode-button active" data-mode="endless">Endlos</button>
            <button class="mode-button" data-mode="rounds">5 Runden</button>
        </div>
        <button id="startGame">Spiel starten</button>
        <button id="howToPlayButton" class="how-to-play">?</button>
    </div>
    
    <div class="game-container" style="display: none;">
        <div class="title-container">
            <h1 class="hanging-title">VibeKreis</h1>
        </div>
        <div class="round-counter" id="roundCounter" style="display: none;">Runde: 1 / 5</div>
        <div class="board-container">
            <div class="board">
                <div class="target-area" id="targetArea"></div>
                <div class="needle-container" id="needleContainer">
                    <div class="needle" id="needle"></div>
                    <div class="needle-center"></div>
                </div>
            </div>
            <div class="category-labels">
                <div class="category-label top" id="topCategory"></div>
                <div class="category-label right" id="rightCategory"></div>
                <div class="category-label bottom" id="bottomCategory"></div>
                <div class="category-label left" id="leftCategory"></div>
            </div>
        </div>
        <div class="controls">
            <button id="toggleButton">Ziel verbergen</button>
            <button id="nextRoundButton" style="display: none;">N√§chste Runde</button>
            <button id="newGameButton" style="background-color: rgba(208, 36, 36, 0.822); color: white">
                Neues Spiel
            </button>
        </div>
        <div id="score"></div>
        <div id="totalScore">Gesamtpunktzahl: 0</div>
    </div>
    
    <script>
        const needleContainer = document.getElementById("needleContainer");
        const needle = document.getElementById("needle");
        const targetArea = document.getElementById("targetArea");
        const toggleButton = document.getElementById("toggleButton");
        const nextRoundButton = document.getElementById("nextRoundButton");
        const newGameButton = document.getElementById("newGameButton");
        const scoreElement = document.getElementById("score");
        const totalScoreElement = document.getElementById("totalScore");
        const countdownOverlay = document.getElementById("countdownOverlay");
        const countdownNumber = document.getElementById("countdownNumber");
        const errorMessageElement = document.getElementById("errorMessage");
        const countErrorMessageElement = document.getElementById("countErrorMessage");
        const roundCounter = document.getElementById("roundCounter");
        const gameOverModal = document.getElementById("gameOverModal");
        const finalScoresDiv = document.getElementById("finalScores");
        
        // Kategorien-Elemente
        const topCategory = document.getElementById("topCategory");
        const rightCategory = document.getElementById("rightCategory");
        const bottomCategory = document.getElementById("bottomCategory");
        const leftCategory = document.getElementById("leftCategory");
        
        let isDragging = false;
        let targetAngle = 0;
        let isTargetVisible = true;
        let totalScore = 0;
        let canMoveNeedle = false;
        let currentNeedleAngle = 0;
        let gameMode = 'endless';
        let currentRound = 1;
        let currentTurn = 0;
        let maxRounds = 5;
        let usedCategories = new Set();
        let isFirstRound = true;
        
        const bannedWords = [
            'nigger', 'nigga', 'neger', 'n+[i1!]+[g9]+', 'n.{0,2}[i1!].{0,2}[g9].{0,2}[g9]',
            'hitler', 'h[i1!]tl[e3]r', 'nazi', 'n[a4]z[i1!]', 'heil', 'nsdap', 'f√ºhrer', 'adolf',
            'hurensohn', 'hure', 'fotze', 'f[o0]tz[e3]', 'schlampe', 'missgeburt',
            'spast', 'sp[a4]st', 'behindert', 'mongo', 'mongol', 'schwuchtel', 'faggot', 'f[a4]gg[o0]t','fag', 'f[a4]g',
            'judensau', 'jud[e3]ns[a4]u', 'zigeuner'
        ];
            
        function isNameBanned(name) {
            const lowerName = name.toLowerCase().trim();
            const cleanedName = lowerName.replace(/[\s\-_\.]/g, '');
            const decodedName = cleanedName
                .replace(/0/g, 'o')
                .replace(/1/g, 'i')
                .replace(/3/g, 'e')
                .replace(/4/g, 'a')
                .replace(/5/g, 's')
                .replace(/7/g, 't')
                .replace(/9/g, 'g');
            
            return bannedWords.some(banned => {
                try {
                    const pattern = new RegExp(banned, 'i');
                    return pattern.test(lowerName) || 
                            pattern.test(cleanedName) ||
                            pattern.test(decodedName);
                } catch (e) {
                    return lowerName.includes(banned) || 
                            cleanedName.includes(banned) ||
                            decodedName.includes(banned);
                }
            });
        }
            
        function checkForDuplicateNames() {
            const inputs = Array.from(teamNames.children);
            const names = inputs.map(input => input.value.toLowerCase().trim()).filter(name => name);
            const uniqueNames = new Set(names);
            return names.length !== uniqueNames.size;
        }
            
        function normalizeAngle(angle) {
            angle = angle % 360;
            if (angle < 0) angle += 360;
            return angle;
        }
        
        const categories = [
            ["Kalt", "Hei√ü", "Trocken", "Feucht"],
            ["Langweilig", "Aufregend", "Entspannend", "Stressig"],
            ["Billig", "Teuer", "Wertvoll", "Wertlos"],
            ["Alt", "Neu", "Zeitlos", "Trendig"],
            ["S√º√ü", "Sauer", "Bitter", "Salzig"],
            ["Laut", "Leise", "Harmonisch", "Chaotisch"],
            ["Hart", "Weich", "Flexibel", "Starr"],
            ["Schnell", "Langsam", "Konstant", "Variabel"],
            ["Dunkel", "Hell", "Bunt", "Einfarbig"],
            ["Nat√ºrlich", "K√ºnstlich", "Organisch", "Synthetisch"],
            ["Einfach", "Komplex", "Intuitiv", "Verwirrend"],
            ["Gro√ü", "Klein", "Mittel", "Extrem"],
            ["Schwer", "Leicht", "Dicht", "Luftig"],
            ["Glatt", "Rau", "Wellig", "Eckig"],
            ["Modern", "Traditionell", "Futuristisch", "Retro"],
            ["Mutig", "Vorsichtig", "Riskant", "Sicher"],
            ["Formal", "Casual", "Elegant", "L√§ssig"],
            ["Digital", "Analog", "Hybrid", "Mechanisch"],
            ["Gesund", "Ungesund", "Nahrhaft", "Leer"],
            ["Stark", "Schwach", "Robust", "Fragil"],
            ["Nah", "Fern", "Erreichbar", "Unerreichbar"],
            ["√ñffentlich", "Privat", "Gemeinschaftlich", "Individuell"],
            ["Rational", "Emotional", "Logisch", "Intuitiv"],
            ["Aktiv", "Passiv", "Dynamisch", "Statisch"],
            ["Sauber", "Schmutzig", "Steril", "Unordentlich"],
            ["Jung", "Alt", "Reif", "Unreif"],
            ["Bekannt", "Unbekannt", "Ber√ºhmt", "Obskur"],
            ["N√ºtzlich", "Nutzlos", "Praktisch", "Dekorativ"],
            ["Echt", "Falsch", "Authentisch", "Imitiert"],
            ["Positiv", "Negativ", "Neutral", "Polarisierend"],
            ["Innen", "Au√üen", "Zentral", "Peripher"],
            ["Offen", "Geschlossen", "Zug√§nglich", "Versperrt"],
            ["Voll", "Leer", "√úberf√ºllt", "Sp√§rlich"],
            ["Seri√∂s", "Lustig", "Ernst", "Albern"],
            ["Professionell", "Amateurhaft", "Experte*in", "Anf√§nger*in"],
            ["Urban", "L√§ndlich", "Vorst√§dtisch", "Wildnis"],
            ["Tag", "Nacht", "D√§mmerung", "Mittag"],
            ["Sommer", "Winter", "Fr√ºhling", "Herbst"],
            ["Nord", "S√ºd", "Ost", "West"],
            ["Himmel", "Erde", "Wasser", "Feuer"],
            ["Gl√ºcklich", "Traurig", "W√ºtend", "Friedlich"],
            ["Erfolgreich", "Gescheitert", "Mittelm√§√üig", "Au√üergew√∂hnlich"],
            ["Freundlich", "Feindlich", "Neutral", "Aggressiv"],
            ["Kreativ", "Analytisch", "K√ºnstlerisch", "Wissenschaftlich"],
            ["Spontan", "Geplant", "Improvisiert", "Strukturiert"],
            ["Minimalistisch", "Maximalistisch", "Schlicht", "√úberladen"],
            ["Mainstream", "Alternative", "Popul√§r", "Nische"],
            ["Lokal", "Global", "Regional", "International"],
            ["Gew√∂hnlich", "Au√üergew√∂hnlich", "Normal", "Speziell"],
            ["Scharf", "Mild", "W√ºrzig", "Fade"],
            ["Frisch", "Abgestanden", "Knusprig", "Matschig"],
            ["Transparent", "Undurchsichtig", "Klar", "Tr√ºb"],
            ["Maskulin", "Feminin", "Neutral", "Androgyn"],
            ["Ordentlich", "Chaotisch", "Strukturiert", "Zuf√§llig"],
            ["Vertraut", "Fremd", "Heimisch", "Exotisch"],
            ["Oberfl√§chlich", "Tiefgr√ºndig", "Flach", "Komplex"],
            ["Introvertiert", "Extrovertiert", "Charismatisch", "Zur√ºckhaltend"],
            ["Optimistisch", "Pessimistisch", "Realistisch", "Tr√§umerisch"],
            ["Sparsam", "Verschwenderisch", "Gro√üz√ºgig", "Geizig"],
            ["P√ºnktlich", "Unp√ºnktlich", "√úberp√ºnktlich", "Immer zu sp√§t"],
            ["Geduldig", "Ungeduldig", "Gelassen", "Nerv√∂s"],
            ["Abenteuerlich", "√Ñngstlich", "Wagemutig", "Sicherheitsorientiert"],
            ["Selbstbewusst", "Unsicher", "Arrogant", "Bescheiden"],
            ["Hilfsbereit", "Egoistisch", "Selbstlos", "Eigenn√ºtzig"],
            ["Kultur-Kenner*in", "Kultur-Banaus*in", "Hochkultur", "Popkultur"],
            ["Tierliebend", "Tierfeindlich", "Katzenmensch", "Hundemensch"],
            ["Morgenmensch", "Nachtmensch", "Mittagstief", "Immer aktiv"],
            ["Kaffee-Junkie", "Tee-Liebhaber*in", "Wasser-Trinker*in", "Energy-Drink-Fan"],
            ["Sportskanone", "Couch-Potato", "Fitness-Fanatiker*in", "Bewegungsmuffel"],
            ["Technik-Affin", "Technik-Skeptiker*in", "Early Adopter", "Analog-Fan"],
            ["Risikofreudig", "Sicherheitsliebend", "Adrenalin-Junkie", "Angsthase"],
            ["Multitasking-Profi", "Fokus-Meister*in", "St√§ndig √ºberfordert", "Tiefenentspannt"],
            ["Naturverbunden", "Stadtmensch", "Wander-Fan", "Stubenhocker*in"],
            ["Musik-Allesfresser*in", "Stille-Genie√üer*in", "Konzert-G√§nger*in", "L√§rmempfindlich"],
            ["B√ºcherwurm", "Serien-Junkie", "Film-Fan", "Podcast-H√∂rer*in"],
            ["Reiselustig", "Heimatverbunden", "Backpacker*in", "Luxus-Urlauber*in"],
            ["Koch-K√ºnstler*in", "Lieferdienst-K√∂nig*in", "Hobby-B√§cker*in", "Mikrowellen-Magier*in"],
            ["Umweltbewusst", "Konsum-Enthusiast*in", "Zero-Waste-Held*in", "Verpackungs-Liebhaber*in"],
            ["Handwerklich begabt", "Zwei linke H√§nde", "DIY-K√∂nig*in", "Reparatur-Muffel"],
            ["Gamer*in", "Brettspiel-Fan", "Social-Media-Star", "Digital-Detox-Anh√§nger*in"],
            ["Qualit√§tsbewusst", "Schn√§ppchen-J√§ger*in", "Markentreu", "No-Name-Fan"],
            ["Planungs-Fanatiker*in", "Spontaneit√§ts-K√ºnstler*in", "To-Do-Listen-Gott", "YOLO-Mentalit√§t"],
            ["Diskussionsfreudig", "Konfliktscheu", "Debattier-Club-Pr√§sident*in", "Harmonies√ºchtig"],
            ["Kritikf√§hig", "D√ºnnh√§utig", "Selbstreflektiert", "Beratungsresistent"],
            ["Kompromissbereit", "Stur", "Diplomat*in", "Rechthaber*in"],
            ["Innovativ", "Traditionsbewusst", "Vision√§r*in", "Nostalgiker*in"],
            ["Detailorientiert", "Gro√ües Ganzes-Denker*in", "Mikro-Manager*in", "√úberblick-Bewahrer*in"],
            ["Entscheidungsfreudig", "Entscheidungsunf√§hig", "Durchsetzungsstark", "Unentschlossen"],
            ["Humorvoll", "Todernst", "Sarkastisch", "Albern"],
            ["Belastbar", "Stressanf√§llig", "Fels in der Brandung", "Nervenb√ºndel"],
            ["Lernbegierig", "Lernfaul", "Wissensdurstig", "Desinteressiert"],
            ["Achtsam", "Gedankenverloren", "Im Hier und Jetzt", "St√§ndig abgelenkt"],
            ["Diszipliniert", " undiszipliniert", "Willensstark", "Prokrastinierend"],
            ["Verantwortungsbewusst", "Verantwortungslos", "Pflichtbewusst", "Leichtsinnig"],
            ["Team-Player*in", "Einzelk√§mpfer*in", "Kooperativ", "Kompetitiv"],
            ["F√ºhrungspers√∂nlichkeit", "Mitl√§ufer*in", "Autorit√§r", "Demokratisch"],
            ["Eine gute Tat", "Eine b√∂se Tat", "Eine notwendige Tat", "Eine nutzlose Tat"],
            ["Wissen", "Glaube", "Meinung", "Fakt"],
            ["Freiheit", "Sicherheit", "Ordnung", "Chaos"],
            ["Schicksal", "Zufall", "Freier Wille", "Vorhersehung"],
            ["Utopie", "Dystopie", "Realit√§t", "Fantasie"],
            ["Vergangenheit", "Zukunft", "Gegenwart", "Alternative Zeitlinie"],
            ["Eine untersch√§tzte Idee", "Eine √ºbersch√§tzte Idee", "Eine gef√§hrliche Idee", "Eine geniale Idee"],
            ["Wahrheit", "L√ºge", "Geheimnis", "Ger√ºcht"],
            ["Blockbuster", "Indie-Film", "Dokumentation", "Kurzfilm"],
            ["Ohrwurm", "Vergessenswerter Song", "Guilty Pleasure", "Klassiker"],
            ["Gutes Meme", "Cringe Meme", "Totes Meme", "Insider-Witz"],
            ["Gute Buchverfilmung", "Schlechte Buchverfilmung", "Besser als das Buch", "Unverfilmbar"],
            ["50er-Nostalgie", "90er-Nostalgie", "2000er-Nostalgie", "Zukunfts-Hype"],
            ["So schlecht, dass es gut ist", "Unfreiwillig komisch", "Einfach nur schlecht", "Meisterwerk"],
            ["Ist ein Sandwich?", "Ist eine Suppe?", "Ist ein Salat?", "Ist ein Verbrechen?"],
            ["Riecht besser als es schmeckt", "Schmeckt besser als es riecht", "Sieht gut aus", "Klingt gut"],
            ["Guter Ort f√ºr ein Nickerchen", "Schlechter Ort f√ºr ein Nickerchen", "Ort zum Verstecken", "Ort f√ºr eine Party"],
            ["Normal im Mittelalter", "Normal heute", "Normal in 100 Jahren", "Niemals normal"],
            ["Braucht Batterien", "Braucht WLAN", "Braucht Liebe", "Braucht keine Anleitung"],
            ["Eine Aktion einer Katze", "Eine Aktion eines Hundes", "Eine Aktion eines Menschen", "Eine Aktion einer KI"],
            ["Sollte illegal sein", "Sollte Pflicht sein", "Ist legal", "Ist eine Grauzone"],
            ["Etwas, das man fl√ºstert", "Etwas, das man schreit", "Etwas, das man singt", "Etwas, das man denkt"],
            ["Kopfentscheidung", "Bauchentscheidung", "Herzentscheidung", "Zufallsentscheidung"],
            ["Tempor√§r", "Permanent", "Zyklisch", "Einmalig"],
            ["Fertigkeit", "Talent", "Wissen", "Gl√ºck"],
            ["Ein Geruch, der beruhigt", "Ein Geruch, der nervt", "Ein vertrauter Geruch", "Ein neuer Geruch"],
            ["Etwas, das man sammelt", "Etwas, das man wegwirft", "Etwas, das man recycelt", "Etwas, das man vergisst"],
            ["Happy End", "Trauriges Ende", "Offenes Ende", "Plot-Twist am Ende"],
            ["Ein Ger√§usch, das beruhigt", "Ein Ger√§usch, das nervt", "Ein lautes Ger√§usch", "Absolute Stille"],
            ["Etwas aus Holz", "Etwas aus Metall", "Etwas aus Plastik", "Etwas aus Glas"],
            ["Street Smart", "Book Smart", "Emotionale Intelligenz", "Kreative Intelligenz"],
            ["Ein Grund zu feiern", "Ein Grund zu trauern", "Ein normaler Dienstag", "Ein nationaler Feiertag"],
            ["Ein Wort, das klug klingt", "Ein Wort, das dumm klingt", "Ein Schimpfwort", "Ein Kosewort"],
            ["Ein Job f√ºr eine Maschine", "Ein Job f√ºr eine*n K√ºnstler*in", "Ein Job f√ºr eine*n Politiker*in", "Ein Job, den es nicht mehr gibt"],
            ["Ein Ort, an dem man allein sein will", "Ein Ort f√ºr eine riesige Party", "Ein geheimer Ort", "Ein √ºberf√ºllter Ort"],
            ["Eine Regel, die man brechen sollte", "Eine Regel, die man befolgen sollte", "Eine ungeschriebene Regel", "Eine dumme Regel"]
        ];
        
        categories.forEach((quad) => {
            for (let i = quad.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [quad[i], quad[j]] = [quad[j], quad[i]];
            }
        });
        
        const teamSetup = document.getElementById('teamSetup');
        const teamCount = document.getElementById('teamCount');
        const teamNames = document.getElementById('teamNames');
        const startGameButton = document.getElementById('startGame');
        const gameContainer = document.querySelector('.game-container');
        
        let teams = [];
        let currentTeamIndex = 0;
        
        // Game mode selection
        document.querySelectorAll('.mode-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.mode-button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                gameMode = this.dataset.mode;
            });
        });
        
        teamCount.addEventListener('change', updateTeamInputs);
        teamCount.addEventListener('input', updateTeamInputs);
        
        function updateTeamInputs() {
            const count = parseInt(teamCount.value);
            
            teamCount.classList.remove('error');
            countErrorMessageElement.classList.remove('show');
            countErrorMessageElement.textContent = '';
            
            if (count < 1 || isNaN(count)) {
                teamCount.classList.add('error');
                countErrorMessageElement.textContent = 'Bitte w√§hle mindestens 1 Team.';
                countErrorMessageElement.classList.add('show');
                teamCount.value = 1;
                teamNames.innerHTML = '';
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = `Name des 1. Teams`;
                input.className = 'team-name-input';
                teamNames.appendChild(input);
                return;
            }
            if (count > 4) {
                teamCount.classList.add('error');
                countErrorMessageElement.textContent = 'Maximal 4 Teams sind erlaubt.';
                countErrorMessageElement.classList.add('show');
                teamCount.value = 4;
            }
            
            const finalCount = Math.min(4, Math.max(1, count));
            teamNames.innerHTML = '';
            for (let i = 0; i < finalCount; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = `Name des ${i + 1}. Teams`;
                input.className = 'team-name-input';
                teamNames.appendChild(input);
            }
        }
        
        function updateScoreDisplay() {
            const scoreHTML = teams.map((team, index) =>
                `<div class="team-score ${index === currentTeamIndex ? 'current-team' : ''}">
                    ${team.name}: ${team.score}
                </div>`
            ).join('');
            totalScoreElement.innerHTML = scoreHTML;
        }
        
        function updateRoundCounter() {
            if (gameMode === 'rounds') {
                roundCounter.style.display = 'inline-block';
                roundCounter.textContent = `Runde: ${currentRound} / ${maxRounds}`;
            } else {
                roundCounter.style.display = 'none';
            }
        }
        
        function showGameOver() {
            const sortedTeams = [...teams].sort((a, b) => b.score - a.score);
            const highestScore = sortedTeams[0].score;
            const winners = sortedTeams.filter(team => team.score === highestScore);
            
            let scoresHTML = sortedTeams.map((team) => {
                const isWinner = team.score === highestScore;
                return `<div class="final-team-score ${isWinner ? 'winner-highlight' : ''}">
                    ${isWinner ? 'üèÜ ' : ''}${team.name}: ${team.score} Punkte
                </div>`;
            }).join('');
            
            finalScoresDiv.innerHTML = scoresHTML;
            gameOverModal.style.display = 'block';
            
            if (typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 200,
                    spread: 120,
                    origin: { y: 0.4 },
                    colors: ['#FFD700', '#feca57', '#3742fa', '#ff6b6b'],
                    ticks: 400,
                    gravity: 0.6
                });
            }
        }
        
        function showCountdown(callback) {
            let count = 3;
            countdownOverlay.style.display = 'flex';
            
            targetArea.classList.add('hidden-for-countdown');
            
            const interval = setInterval(() => {
                if (count > 0) {
                    countdownNumber.textContent = count;
                    countdownNumber.style.animation = 'none';
                    setTimeout(() => {
                        countdownNumber.style.animation = 'pulse 1s ease-in-out';
                    }, 10);
                    count--;
                } else {
                    clearInterval(interval);
                    countdownOverlay.style.display = 'none';
                    targetArea.classList.remove('hidden-for-countdown');
                    callback();
                }
            }, 1000);
            
            countdownNumber.textContent = count;
            count--;
        }
        
        function showCategories() {
            topCategory.classList.add('visible');
            rightCategory.classList.add('visible');
            bottomCategory.classList.add('visible');
            leftCategory.classList.add('visible');
        }
        
        function hideCategories() {
            topCategory.classList.remove('visible');
            rightCategory.classList.remove('visible');
            bottomCategory.classList.remove('visible');
            leftCategory.classList.remove('visible');
        }
        
        startGameButton.addEventListener('click', () => {
            errorMessageElement.classList.remove('show');
            errorMessageElement.textContent = '';
            Array.from(teamNames.children).forEach(input => input.classList.remove('error'));
            
            const count = parseInt(teamCount.value);
            if (count < 1 || count > 4 || isNaN(count)) {
                teamCount.classList.add('error');
                countErrorMessageElement.textContent = 'Bitte w√§hle eine g√ºltige Teamanzahl (1-4).';
                countErrorMessageElement.classList.add('show');
                return;
            }
            
            const inputs = Array.from(teamNames.children);
            let hasBannedWords = false;
            
            inputs.forEach(input => {
                if (input.value && isNameBanned(input.value)) {
                    input.classList.add('error');
                    hasBannedWords = true;
                }
            });
            
            if (hasBannedWords) {
                errorMessageElement.textContent = 'Bitte verwende angemessene Teamnamen.';
                errorMessageElement.classList.add('show');
                return;
            }
            
            if (checkForDuplicateNames()) {
                errorMessageElement.textContent = 'Jedes Team muss einen einzigartigen Namen haben.';
                errorMessageElement.classList.add('show');
                
                const names = inputs.map(input => input.value.toLowerCase().trim());
                inputs.forEach((input, i) => {
                    if (names.indexOf(names[i]) !== i && names[i]) {
                        input.classList.add('error');
                    }
                });
                return;
            }
            
            teams = inputs.map((input, index) => ({
                name: input.value || `Team ${index + 1}`,
                score: 0
            }));
            
            currentRound = 1;
            currentTurn = 0;
            isFirstRound = true;
            usedCategories.clear();
            
            teamSetup.style.display = 'none';
            gameContainer.style.display = 'block';
            updateScoreDisplay();
            
            // Start first round immediately
            nextRoundButton.click();
        });
        
        updateTeamInputs();
        
        function setTargetArea() {
            targetAngle = Math.random() * 360;
            
            const gradient = `conic-gradient(
                from ${targetAngle - 180}deg at 50% 50%,
                #a4b0be 0deg,
                #a4b0be 160deg,
                #ff6b6b 160deg,
                #ff6b6b 172deg,
                #3742fa 172deg,
                #3742fa 178deg,
                #FFD700 178deg,
                #FFD700 182deg,
                #3742fa 182deg,
                #3742fa 188deg,
                #ff6b6b 188deg,
                #ff6b6b 200deg,
                #a4b0be 200deg,
                #a4b0be 360deg
            )`;
            
            targetArea.style.background = gradient;
        }
        
        function setRandomCategories() {
            let randomIndex;
            let attempts = 0;
            const maxAttempts = categories.length;
            
            // Wenn alle Kategorien verwendet wurden, setze zur√ºck
            if (usedCategories.size >= categories.length) {
                usedCategories.clear();
            }
            
            // Finde eine unbenutzte Kategorie
            do {
                randomIndex = Math.floor(Math.random() * categories.length);
                attempts++;
                if (attempts >= maxAttempts) {
                    // Fallback: Wenn keine unbenutzten gefunden werden, setze zur√ºck
                    usedCategories.clear();
                    break;
                }
            } while (usedCategories.has(randomIndex));
            
            usedCategories.add(randomIndex);
            
            const [top, right, bottom, left] = categories[randomIndex];
            topCategory.textContent = top;
            rightCategory.textContent = right;
            bottomCategory.textContent = bottom;
            leftCategory.textContent = left;
        }
        
        function calculateScore(angle) {
            const normalizedTarget = normalizeAngle(targetAngle);
            const normalizedNeedle = normalizeAngle(angle);
            
            let diff = Math.abs(normalizedTarget - normalizedNeedle);
            if (diff > 180) diff = 360 - diff;
            
            if (diff <= 2) {
                triggerConfetti();
                return 5;
            }
            if (diff <= 12) return 3;
            if (diff <= 35) return 1;
            return 0;
        }
        
        function handleStart(e) {
            if (!canMoveNeedle) return;
            isDragging = true;
            e.preventDefault();
        }
        
        function triggerConfetti() {
            if (typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 150,
                    spread: 90,
                    origin: { y: 0.6 },
                    colors: ['#FFD700', '#feca57', '#3742fa'],
                    ticks: 300,
                    shapes: ['square'],
                    gravity: 0.8,
                    scalar: 1.2
                });
            }
        }
        
        function handleMove(e) {
            if (!isDragging || !canMoveNeedle) return;
            e.preventDefault();
            
            const rect = needleContainer.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            let clientX, clientY;
            if (e.type === "touchmove") {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const deltaX = clientX - centerX;
            const deltaY = clientY - centerY;
            const angle = Math.atan2(deltaX, -deltaY) * (180 / Math.PI);
            
            currentNeedleAngle = normalizeAngle(angle);
            needle.style.transform = `translate(-50%, -100%) rotate(${currentNeedleAngle}deg)`;
        }
        
        function handleEnd() {
            isDragging = false;
        }
        
        function hideNeedle() {
            needle.style.display = "none";
        }
        
        function showNeedle() {
            needle.style.display = "block";
        }
        
        const modal = document.getElementById("howToPlayModal");
        const howToPlayButton = document.getElementById("howToPlayButton");
        const closeButton = modal.querySelector(".close-button");
        
        howToPlayButton.onclick = function () {
            modal.style.display = "block";
            setTimeout(() => modal.classList.add("show"), 10);
        }
        
        closeButton.onclick = function () {
            modal.classList.remove("show");
            setTimeout(() => modal.style.display = "none", 300);
        }
        
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.classList.remove("show");
                setTimeout(() => modal.style.display = "none", 300);
            }
        }
        
        needleContainer.addEventListener("mousedown", handleStart);
        document.addEventListener("mousemove", handleMove);
        document.addEventListener("mouseup", handleEnd);
        
        needleContainer.addEventListener("touchstart", handleStart, { passive: false });
        document.addEventListener("touchmove", handleMove, { passive: false });
        document.addEventListener("touchend", handleEnd);
        
        toggleButton.addEventListener("click", () => {
            isTargetVisible = !isTargetVisible;
            targetArea.style.display = isTargetVisible ? "block" : "none";
            if (!isTargetVisible) {
                toggleButton.textContent = "Ziel aufdecken";
                scoreElement.textContent = "";
                showNeedle();
                canMoveNeedle = true;
                nextRoundButton.style.display = "none";  // Hide next round button
            } else {
                toggleButton.style.display = "none";
                const score = calculateScore(currentNeedleAngle);
                teams[currentTeamIndex].score += score;
                scoreElement.textContent = `${teams[currentTeamIndex].name} erzielt: ${score} Punkte`;
                updateScoreDisplay();
                canMoveNeedle = false;
                nextRoundButton.style.display = "inline-block";  // Show next round button after revealing
            }
        });
        
        nextRoundButton.addEventListener("click", () => {
            // Don't increment currentTurn on the very first round
            if (!isFirstRound) {
                currentTurn++;
            }
            isFirstRound = false;
            
            if (gameMode === 'rounds' && teams.length > 0) {
                // Check if all teams have played this round
                if (currentTurn > 0 && currentTurn % teams.length === 0) {
                    currentRound++;
                    if (currentRound > maxRounds) {
                        showGameOver();
                        return;
                    }
                }
                updateRoundCounter();
            }
            
            hideCategories();
            setTargetArea();
            setRandomCategories();
            isTargetVisible = true;
            targetArea.style.display = "block";
            toggleButton.textContent = "Ziel verbergen";
            toggleButton.style.display = "inline-block";
            needle.style.transform = "translate(-50%, -100%) rotate(0deg)";
            currentNeedleAngle = 0;
            scoreElement.textContent = "";
            hideNeedle();
            canMoveNeedle = false;
            nextRoundButton.style.display = "none";  // Hide next round button for new round
            
            if (teams.length > 0) {
                currentTeamIndex = (currentTeamIndex + 1) % teams.length;
                updateScoreDisplay();
            }
            
            showCountdown(() => {
                showCategories();
            });
        });
        
        newGameButton.addEventListener("click", () => {
            const userConfirmed = confirm("Bist du sicher, dass du ein neues Spiel starten m√∂chtest? Alle Punktest√§nde gehen verloren!");
            if (userConfirmed) {
                location.reload();
            }
        });
        
        setTargetArea();
        setRandomCategories();
        hideNeedle();
        hideCategories();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.4/dist/confetti.browser.min.js"></script>
</body>

</html>